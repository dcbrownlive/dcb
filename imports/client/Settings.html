<template name="Settings">
  <h1>Settings</h1>
  <h2>Channels Management</h2>

  <!-- TODO: use an image collection, and generate options -->
  <datalist id="imagelist">
    <option value="/default.png"></option>
    <option value="/tang1.png"></option>
    <option value="/tang2.png"></option>
    <option value="/tang3.png"></option>
    <option value="/tang4.png"></option>
    <option value="/tang5.png"></option>
    <option value="/favicon-32.png"></option>
  </datalist>

  <table class="pure-table">
    <thead>
      <tr>
        <th>Channel</th>
        <th>Translation</th>
        <th>World Map</th>
        <th>Greet</th>
        <th>Song Requests</th>
        <th>More</th>
      </tr>
    </thead>
    <tbody>
      {{#each c in getChannels}}
      <tr id="{{c._id}}" class="channelEdit">
        <td>
          <div>
            {{>CheckMark b=c.enabled n="enabled" c=c}}
            <span class="{{#if isCurEditChan c._id}} strong {{/if}}">
              {{c.channel}}
            </span>
          </div>

          {{#if isCurEditChan c._id}}
          <button class="delete">remove</button>
          {{/if}}
        </td>
        <td class="centered">
          {{>CheckMark b=c.tr n="tr"}}
        </td>

        <td class="centered">
          {{>CheckMark b=c.map n="map"}}
          {{#if c.map}}
          <a href="/c/{{c.channel}}">&#9732; </a>
          {{#if isCurEditChan c._id}}
          <table>
            <tbody>
              <tr>
                <td>
                  Standard icon:
                </td>
                <td>
                  <input class="chanSettings" value="{{c.map_icon_std}}" list="imagelist" name="map_icon_std">
                </td>
                <td>
                  <img src="{{c.map_icon_std}}">
                </td>
              </tr>
              <tr>
                <td>
                  Name icon:
                </td>
                <td>
                  <input class="chanSettings" value="{{c.map_icon_name}}" list="imagelist" name="map_icon_name">
                </td>
                <td>
                  <img src="{{c.map_icon_name}}">
                </td>
              </tr>
              <tr>
                <td>
                  Message icon:
                </td>
                <td>
                  <input class="chanSettings" value="{{c.map_icon_msg}}" list="imagelist" name="map_icon_msg">
                </td>
                <td>
                  <img src="{{c.map_icon_msg}}">
                </td>
              </tr>
            </tbody>
          </table>
          {{/if}}
          {{/if}}
        </td>

        <td class="centered">
          {{>CheckMark b=c.greet n="greet"}}
          <table>
            <tbody>
              {{#if isCurEditChan c._id}}
              {{#if c.greet}}
              <tr>
                <td>/me prefix</td>
                <td>{{>CheckMark b=c.me n="me"}}</td>
              </tr>
              <tr>
                <td>Mute</td>
                <td>{{>CheckMark b=c.muteGreet n="muteGreet"}}</td>
              </tr>
              <tr>
                <td>
                  Catch !so Cmd:
                </td>
                <td>
                  {{>CheckMark b=c.so n="so"}}
                </td>
              </tr>
              <tr>
                <td>
                  Shoutout Cmd:
                </td>
                <td>
                  <input type="text" value="{{c.socmd}}" class="chanSettings" name="socmd">
                </td>
              </tr>
              {{/if}}
              {{/if}}
            </tbody>
          </table>
        </td>

        <td class="centered">
          {{>CheckMark b=c.songrequest n="songrequest"}}

          {{#if c.songrequest}}
          <table>
            <tbody>
              <tr>
                <td> RegExp 1 </td>
                <td> <input type="text" value="{{c.requestregex1}}" class="chanSettings" name="requestregex1"> </td>
              </tr>
              <tr>
                <td> RegExp 2 </td>
                <td> <input type="text" value="{{c.requestregex2}}" class="chanSettings" name="requestregex2"> </td>
              </tr>
            </tbody>
          </table>
          {{/if}}
        </td>

        <td class="centered">
          <table>
            <tbody>
              <tr>
                <td>
                  Quizz
                </td>
                <td>
                  {{>CheckMark b=c.quizz n="quizz"}}
                </td>
              </tr>
              <tr>
                <td>
                  Active users
                </td>
                <td>
                  {{>CheckMark b=c.active_users n="active_users"}}
                </td>
              </tr>

            </tbody>
          </table>
        </td>
      </tr>
      {{/each}}
    </tbody>
  </table>

  {{#if isUserRole "admin greet"}}

  <h4>Add Channel (need to restart)</h4>
  <table>
    <tbody>
      <tr>
        <td> <input id="newChannel"> </td>
        <td> <button class="addChannel">Add Channel </button> </td>
      </tr>
    </tbody>
  </table>

  <h2>Translation stats</h2>
  <!-- todo: format correctly year/months-->
  <table class="pure-table">
    <thead>
      <th>Channel</th>
    </thead>
    <tbody>
      {{#each c in getChannels}}
      <tr>
        <td>
          {{c.channel}}
        </td>
        {{#each s in (stats c.channel)}}
        <td>
          {{s.count}}
        </td>
        {{/each}}
      </tr>
      {{/each}}
    </tbody>
  </table>

  <h2>Accounts</h2>
  <table class="pure-table">
    <thead>
      <tr>
        <th>User</th>
        <th>Groups</th>
        <th>Admin</th>
        <th>Streamer</th>
      </tr>
    </thead>
    <tbody>
      {{#each u in users}}
      <tr id="{{u._id}}">
        <td>
          {{u.username}}
        </td>
        <td>
          <input class="profile" value="{{u.profile.groups}}" name="groups">
        </td>
        <td>
          {{>CheckMark n="uadmin" b=(userHasRole u._id "admin")}}
        </td>
        <td>
          {{>CheckMark n="ustreamer" b=(userHasRole u._id "streamer")}}
        </td>
      </tr>
      {{/each}}
    </tbody>
  </table>

  <h4>Add Account</h4>
  <table>
    <tbody>
      <tr>
        <td>Name:</td>
        <td> <input id="accountName"> </td>
      </tr>
      <tr>
        <td>Password:</td>
        <td> <input id="accountPass"> </td>
      </tr>
      <tr>
        <td>Channel:</td>
        <td> <input id="accountChan"> </td>
      </tr>
      <tr>
        <td>Guest Password:</td>
        <td> <input id="accountGuestPass"> </td>
      </tr>
      <tr>
        <td>Streamer Account:</td>
        <td> <input id="accountStreamer" type="checkbox"> </td>
      </tr>
      <button name="addAccount">Create Account</button>
    </tbody>
  </table>

  <h2>Configuration</h2>
  <table>
    <tbody>
      <tr>
        <td>          
          Website URL
        </td>
        <td>          
          <input id="URL" value="{{WEBSITE_URL}}">
        </td>        
      </tr>
    </tbody>
  </table>
  <!--
    <h2>Main Parameters</h2>
    Location Interval (in seconds)
    <input id="location_interval" type="number" value="5">
  -->

  {{/if}}

  <br>
  <img src="/bot.png">
</template>